ocr-platform/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # Entry point FastAPI
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py        # ConfiguraÃ§Ãµes (env)
â”‚   â”‚   â””â”€â”€ database.py      # ConexÃ£o PostgreSQL
â”‚   â”‚
â”‚   â”œâ”€â”€ models/              # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ document.py
â”‚   â”‚   â””â”€â”€ base.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/             # Pydantic schemas
â”‚   â”‚   â””â”€â”€ document.py
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ documents.py     # Upload e consulta
â”‚   â”‚
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ storage.py       # MinIO / filesystem
â”‚
â”œâ”€â”€ workers/                 # (Sprint 2)
â”œâ”€â”€ ml/                      # (Sprint 2+)
â”‚
â”œâ”€â”€ migrations/              # Alembic
â”œâ”€â”€ tests/
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md


Como mudÃ¡mos a forma como o sistema "vÃª", precisamos de processar o documento novamente do zero.

Limpar a Base de Dados e Ficheiros (Recomendado):

PowerShell

docker-compose down -v
docker-compose up -d
# Apagar manualmente os ficheiros na pasta ocr_platform/segments
python init_db.py
Reiniciar a API:

PowerShell

uvicorn app.main:app --reload
Fazer Upload e Processar:

Faz o upload do PDF novamente (ID 1).

Corre o worker: python workers/ocr_worker.py.

Com certeza! ChegÃ¡mos a um marco muito importante. O sistema estÃ¡ funcional, robusto para documentos antigos e com o ciclo de aprendizagem completo.

Aqui tens um conteÃºdo completo e profissional para o teu ficheiro `README.md`. Ele documenta como instalar, rodar e, o mais importante, **como funciona o ciclo de melhoria contÃ­nua** que desenvolvemos.

Podes copiar e colar isto diretamente no ficheiro `ocr_platform/README.md`.

---

```markdown
# ğŸ‡¦ğŸ‡´ OCR Inteligente - Registos de Angola

Plataforma de digitalizaÃ§Ã£o e reconhecimento de texto manuscrito (OCR) focada em registos histÃ³ricos e oficiais de Angola (Assentos de Nascimento, Ã“bito, etc.). O sistema utiliza InteligÃªncia Artificial (TrOCR) com uma arquitetura "Human-in-the-loop", permitindo que o modelo aprenda e evolua com as correÃ§Ãµes dos operadores.

## ğŸš€ Funcionalidades Principais

* **IngestÃ£o de Documentos:** Suporte a PDF e Imagens via API REST.
* **VisÃ£o Computacional AvanÃ§ada:** Algoritmos robustos para limpeza de documentos histÃ³ricos (remoÃ§Ã£o de fundo, normalizaÃ§Ã£o, remoÃ§Ã£o de linhas de tabelas e correÃ§Ã£o de inclinaÃ§Ã£o).
* **OCR Manuscrito:** UtilizaÃ§Ã£o do modelo Microsoft TrOCR (Transformer-based OCR).
* **Interface de ValidaÃ§Ã£o:** Painel para humanos visualizarem os segmentos recortados e corrigirem o texto.
* **Aprendizagem ContÃ­nua:** Scripts para gerar datasets a partir das correÃ§Ãµes e re-treinar a IA automaticamente.

---

## ğŸ› ï¸ InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

### 1. PrÃ©-requisitos
* Python 3.10 ou superior
* Docker Desktop (para a base de dados PostgreSQL)
* Git

### 2. Configurar o Ambiente
```bash
# Entrar na pasta do projeto
cd backend/ocr_platform

# Criar ambiente virtual
python -m venv .venv

# Ativar ambiente (Windows)
.venv\Scripts\activate

# Instalar dependÃªncias
pip install -r requirements.txt

```

### 3. Iniciar a Infraestrutura

```bash
# Levantar a Base de Dados (PostgreSQL)
docker-compose up -d

# Criar as tabelas na base de dados
python init_db.py

## â–¶ï¸ Como Executar

O sistema Ã© composto por trÃªs partes que funcionam em conjunto:

### 1. Iniciar a API (Backend)

Serve para receber ficheiros e fornecer dados Ã  interface.

```bash
uvicorn app.main:app --reload

```

*Acesse a documentaÃ§Ã£o da API em: https://www.google.com/search?q=http://127.0.0.1:8000/docs*
para carregar documentos manuscritos via endpoint `POST /documents/upload`.

### 2. Interface de Operador (Frontend)

Basta abrir o ficheiro `frontend_test.html` no seu navegador. Ã‰ aqui que verÃ¡ os resultados e farÃ¡ correÃ§Ãµes.

### 3. Processar Documentos (Worker)

Para processar os documentos pendentes ou testar um documento especÃ­fico:

```bash
python workers/ocr_worker.py

```

---

## ğŸ”„ O Ciclo de Trabalho (Workflow)

Este Ã© o fluxo principal para ensinar a IA a ler os manuscritos de Angola:

### Passo 1: IngestÃ£o

Envie um PDF (ex: `14F.pdf`) atravÃ©s da API (`POST /documents/upload`) ou coloque-o na pasta `uploads/`.

### Passo 2: Processamento (OCR)

Execute o `workers/ocr_worker.py`. O sistema irÃ¡:

1. **Limpar a imagem:** Remover o fundo amarelado, linhas de pauta e margens pretas (`ml/preprocessing/image.py`).
2. **Segmentar:** Recortar linha a linha.
3. **Ler:** Usar o modelo de IA para prever o texto.

### Passo 3: ValidaÃ§Ã£o Humana

Abra o `frontend_test.html`.

1. Veja a imagem recortada.
2. Corrija o texto se a IA tiver errado.
3. Clique em **"Validar"**. O texto correto Ã© salvo na base de dados.

### Passo 4: Re-Treino (Fine-Tuning)

Quando tiver vÃ¡rias correÃ§Ãµes feitas, ensine a IA:

1. **Gerar Pacote de Treino:**
```bash
python ml/training/build_dataset.py

```


*Isto cria a pasta `data/dataset_v1` com as imagens e o texto correto.*
2. **Treinar o Modelo:**
```bash
python ml/training/train_trocr.py

```


*Isto cria um novo "cÃ©rebro" em `models/ocr/trocr_finetuned_v1`.*

Na prÃ³xima vez que rodar o Worker, ele usarÃ¡ automaticamente o modelo novo e mais inteligente! ğŸ§ 

---

## ğŸ“‚ Estrutura do Projeto

* `app/`: CÃ³digo da API (Rotas, Modelos de Base de Dados, ConfiguraÃ§Ãµes).
* `ml/`: NÃºcleo de InteligÃªncia Artificial.
* `preprocessing/`: LÃ³gica de limpeza de imagem (OpenCV, NormalizaÃ§Ã£o).
* `inference/`: CÃ³digo que executa a leitura (Hugging Face Transformers).
* `training/`: Scripts de treino e criaÃ§Ã£o de datasets.


* `workers/`: Scripts de processamento em segundo plano.
* `segments/`: Pasta temporÃ¡ria com os recortes das linhas (gerado automaticamente).
* `models/`: Onde os modelos treinados sÃ£o guardados.

