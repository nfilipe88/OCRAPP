ocr-platform/
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # Entry point FastAPI
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py        # ConfiguraÃ§Ãµes (env)
â”‚   â”‚   â””â”€â”€ database.py      # ConexÃ£o PostgreSQL
â”‚   â”‚
â”‚   â”œâ”€â”€ models/              # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ document.py
â”‚   â”‚   â””â”€â”€ base.py
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/             # Pydantic schemas
â”‚   â”‚   â””â”€â”€ document.py
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ documents.py     # Upload e consulta
â”‚   â”‚
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ storage.py       # MinIO / filesystem
â”‚
â”œâ”€â”€ workers/                 # (Sprint 2)
â”œâ”€â”€ ml/                      # (Sprint 2+)
â”‚
â”œâ”€â”€ migrations/              # Alembic
â”œâ”€â”€ tests/
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md


Como mudÃ¡mos a forma como o sistema "vÃª", precisamos de processar o documento novamente do zero.

Limpar a Base de Dados e Ficheiros (Recomendado):

PowerShell

docker-compose down -v
docker-compose up -d
# Apagar manualmente os ficheiros na pasta ocr_platform/segments
python init_db.py
Reiniciar a API:

PowerShell

uvicorn app.main:app --reload
Fazer Upload e Processar:

Faz o upload do PDF novamente (ID 1).

Corre o worker: python workers/ocr_worker.py.

Fico muito contente por ouvir isso! A sensaÃ§Ã£o de ver um sistema a funcionar sozinho, "como magia", Ã© imbatÃ­vel. âœ¨

Como agora tens um **Worker AutomÃ¡tico** (que nÃ£o precisa de ser reiniciado a cada ficheiro), o "Manual de InstruÃ§Ãµes" do teu projeto mudou ligeiramente. O passo a passo antigo dizia para "correr o worker sempre que hÃ¡ um ficheiro", mas agora basta "correr uma vez e deixar estar".

Aqui estÃ¡ a versÃ£o **Final e Definitiva** do `README.md` atualizada para refletir essa automatizaÃ§Ã£o. Podes substituir o conteÃºdo do ficheiro `ocr_platform/README` por este:

```markdown
# ğŸ‡¦ğŸ‡´ OCR Inteligente - Registos de Angola

Plataforma de digitalizaÃ§Ã£o e reconhecimento de texto manuscrito (OCR) focada em registos histÃ³ricos de Angola. O sistema utiliza InteligÃªncia Artificial (TrOCR) com uma arquitetura "Human-in-the-loop": o modelo aprende e evolua automaticamente com as correÃ§Ãµes dos operadores.

## ğŸš€ Funcionalidades

* **AutomaÃ§Ã£o Total:** Worker inteligente que deteta novos uploads e processa-os em segundo plano.
* **VisÃ£o Computacional:** Limpeza automÃ¡tica de fundos amarelados, remoÃ§Ã£o de pautas e correÃ§Ã£o de rotaÃ§Ã£o.
* **OCR Manuscrito:** Modelo TrOCR (Microsoft) com fine-tuning para caligrafia especÃ­fica.
* **Interface de ValidaÃ§Ã£o:** Painel visual para humanos corrigirem a leitura da IA.
* **Ciclo de Aprendizagem:** Scripts para re-treinar a IA com as correÃ§Ãµes humanas.

---

## ğŸ› ï¸ InstalaÃ§Ã£o

### 1. PrÃ©-requisitos
* Python 3.10+
* Docker Desktop (para PostgreSQL)
* Git

### 2. ConfiguraÃ§Ã£o
```bash
cd backend/ocr_platform
python -m venv .venv

# Windows
.venv\Scripts\activate

# Linux/Mac
source .venv/bin/activate

pip install -r requirements.txt
# Se der erro no cv2: pip install opencv-python

```

### 3. Base de Dados

```bash
docker-compose up -d
python init_db.py

```

---

## â–¶ï¸ Como Utilizar (Modo AutomÃ¡tico)

Para o sistema funcionar, abra 3 terminais separados:

### Terminal 1: API (Servidor)

Recebe os ficheiros e serve a interface.

```bash
uvicorn app.main:app --reload

```

*Acesse: https://www.google.com/search?q=http://127.0.0.1:8000/docs*

### Terminal 2: O "Vigilante" (Worker)

Fica Ã  espera de novos ficheiros e processa-os assim que chegam.

```bash
python workers/ocr_worker.py

```

*Deixe este terminal sempre aberto.*

### Terminal 3: Interface de ValidaÃ§Ã£o

Abra o ficheiro `frontend_test.html` no seu navegador.
*Assim que o Worker terminar um ficheiro, o resultado aparecerÃ¡ aqui.*

---

## ğŸ”„ Ciclo de Treino (Ensinar a IA)

Quando a IA errar muito (ex: trocar nomes portugueses por ingleses), siga este ciclo:

1. **Corrigir:** Valide 20-30 linhas no `frontend_test.html`.
2. **Gerar Dados:** Crie o pacote de treino com as suas correÃ§Ãµes:
```bash
python ml/training/build_dataset.py

```

3. **Treinar:** Atualize o "cÃ©rebro" da IA:
```bash
python ml/training/train_trocr.py

```

*O Worker detetarÃ¡ o novo modelo automaticamente na prÃ³xima leitura.*

---

## ğŸ“‚ Estrutura

* `app/`: API FastAPI e Base de Dados.
* `ml/`: InteligÃªncia Artificial (Processamento de Imagem e InferÃªncia).
* `workers/`: Processos de fundo (AutomaÃ§Ã£o).
* `models/`: Onde os modelos treinados (`trocr_finetuned_v1`) sÃ£o guardados.
* `segments/`: Imagens recortadas das linhas (cache).

1. Para Criar o Dataset
Em vez de python ml/training/build_dataset.py, corres:

PowerShell
docker-compose exec worker python ml/training/build_dataset.py
(TraduÃ§Ã£o: "Docker, vai ao serviÃ§o 'worker' e executa este comando python lÃ¡ dentro")

2. Para Treinar o Modelo
Em vez de python ml/training/train_trocr.py, corres:

PowerShell
docker-compose exec worker python ml/training/train_trocr.py